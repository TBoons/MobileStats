<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mobile Stats 2.0</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://use.fontawesome.com/33e3e134da.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <style>
      body {
        background-color: black;
      }
      .unit {
        color: black;
        font-size: 18px;
        width: 125px;
        background-color: #C0C0C0;
        text-align: center;
        margin-left: 2px;
        margin-right: 2px;
      }
      .unit_location {
        font-size: 10px;
        white-space: normal;
        height: 29px;
      }
      .btn {
        margin: 5px;
      }

    </style>
  </head>
  <body>
    <div id="content" class="container-fluid"></div>
    <script type="text/babel">
      var data = [
        {
          "unit_id": "M01",
          "status": "ER",
          "timestamp": "5/12/2016 07:17",
          "channel": "DISP1",
          "assigned_incident": 112345,
          "location": "1683 HANSON ST",
          "agency": "LC",
          "district": "S",
          "inservice": "Y"

        },
        {
          "unit_id": "M02",
          "status": "AQ",
          "timestamp": "5/12/2016 06:10",
          "channel": "",
          "assigned_incident": 0 ,
          "location": "IN STATION",
          "agency": "LC",
          "district": "S",
          "inservice": "Y"

        },
        {
          "unit_id": "M03",
          "status": "TR",
          "timestamp": "5/12/2016 07:10",
          "channel": "DISP1",
          "assigned_incident": 112347,
          "location": "D1 P1 P2 1P3 X26",
          "agency": "LC",
          "district": "N",
          "inservice": "Y"

        },
        {
          "unit_id": "M04",
          "status": "AQ",
          "timestamp": "5/12/2016 05:25",
          "channel": "",
          "assigned_incident": 0,
          "location": "IN STATION",
          "agency": "LC",
          "district": "CC",
          "inservice": "Y"

        },
        {
          "unit_id": "M05",
          "status": "RQ",
          "timestamp": "5/12/2016 07:18",
          "channel": "",
          "assigned_incident": 0,
          "location": "TAMPA/SAN CARLOS>>EMS09",
          "agency": "LC",
          "district": "W",
          "inservice": "Y"

        },
        {
          "unit_id": "M06",
          "status": "SA",
          "timestamp": "5/12/2016 07:10",
          "channel": "DISP2",
          "assigned_incident": 112348,
          "location": "4009 SW 23RD AVE",
          "agency": "LC",
          "district": "S",
          "inservice": "Y"
        }
      ];

      var incidents = {
        "incident":{
          "incident_id":112348
          ,"incident_text":"BLAH BLAH STUFF HERE"
          ,"agency_incident_number":"MLC160517039578"
          ,"incident_type":"BREATHING PROBLEMS"
          ,"incident_crew":"BELL, ROBERT / VARA, DANIEL /"
        }
      };

      var status_icons = {
        "status": {
          "default" : "fa-ambulance"
          ,"DP" : "fa-medkit"
          ,"ER" : "fa-medkit"
          ,"AR" : "fa-medkit"
          ,"TR" : "fa-medkit"
          ,"TA" : "fa-medkit"
          ,"OL" : "fa-medkit"
          ,"EO" : "fa-medkit"
          ,"AQ" : "fa-home"
          ,"AS" : "fa-arrow-circle-right"
          ,"SB" : "fa-arrow-circle-right"
          ,"ES" : "fa-arrow-circle-right"
          ,"RQ" : "fa-ambulance"
        }
      };

      var application_settings = {
        "icon_size": 3
      };

      var UnitsBox = React.createClass({
        render: function() {
          var unitNodes = this.props.data.map(function(unit){
            var thisStatusIcon = status_icons.status['default']; //sets icon to default

            if ( status_icons.status[unit.status] != undefined ){ //finds icon in structure
              thisStatusIcon = status_icons.status[unit.status];
            }
            return (
                <Unit {...unit} key={unit.unit_id} statusIcon={thisStatusIcon} >
                  {unit.unit_id}
                </Unit>
              );
          });

          return (
              <div className="row unitsBox" >
                {unitNodes}
              </div>
            );
        }
      });

      var Unit = React.createClass({
        render: function() {
          var thisClass = "fa " + this.props.statusIcon + " fa-" + application_settings.icon_size + "x";
          return (
              <div className="col-md-1 unit">
                <div className="unit_title">{this.props.unit_id} - {this.props.status}</div>
                <div className="unit_image">
                  <a href="#unitPop" data-toggle="modal" className="open-UnitPop" id={this.props.unit_id} ><i className={thisClass} aria-hidden="true"></i></a>
                </div>
                <div className="unit_location" >
                  {this.props.location}
                </div>
                <div className="unit_timeInStatus">
                  0:33
                </div>
              </div>
            );
        }
      });

      $(document).on("click", ".open-UnitPop", function () {
        console.log(this.id);
        var unit_id = this.id;
        $("#unitPop_header").html("<h4>" + unit_id + "</h4>");
        $("#unitPop_incidentText").html( incidents.incident.incident_text );
        $("#unitPop_incidentType").html( "Incident Type: " + incidents.incident.incident_type );
        $("#unitPop_incidentCrew").html( "Crew: " + incidents.incident.incident_crew );
      });

      ReactDOM.render(
        <UnitsBox data={data} />,
        document.getElementById('content')
      );
    </script>

    <div class="modal fade" id="unitPop" role="dialog" >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" id="unitPop_header">
          </div>
          <div class="modal-body" id="unitPop_body">
            <p id="unitPop_incidentText"></p>
            <p id="unitPop_incidentType"></p>
            <p id="unitPop_incidentCrew"></p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
